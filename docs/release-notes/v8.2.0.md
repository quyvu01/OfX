# OfX v8.2.0 Release Notes

**Release Date:** January 18, 2026

## Overview

OfX v8.2.0 introduces significant improvements including the **Result Pattern** for better error handling, **Supervisor Pattern** for message-based transport fault tolerance, and important **breaking changes** to response class naming conventions.

---

## Highlights

### Result Pattern

A new functional `Result` pattern has been added, providing a cleaner way to handle success and failure scenarios without throwing exceptions.

```csharp
// New Result pattern usage
Result result = await handler.HandleAsync(request);

if (result.IsSuccess)
{
    var data = result.Value;
}
else
{
    var fault = result.Fault;
    // Handle error: fault.Message, fault.Code, fault.Exception
}
```

### Supervisor Pattern for Message-Based Transports

Inspired by Erlang/OTP and Akka, the Supervisor pattern provides automatic failure recovery for message-based transports (NATS, RabbitMQ, Kafka, Azure Service Bus).

**Features:**
- Exponential backoff for restart delays (1s initial, 5m max)
- Configurable restart limits within a time window
- Circuit breaker to prevent restart storms
- Exception type to directive mapping
- Health state tracking (Healthy, Degraded, Unhealthy, CircuitOpen, Stopped)

```csharp
services.AddOfX(cfg =>
{
    cfg.ConfigureSupervisor(opts =>
    {
        opts.Strategy = SupervisionStrategy.OneForOne;
        opts.MaxRestarts = 5;
        opts.EnableCircuitBreaker = true;
        opts.CircuitBreakerThreshold = 3;
    });
    cfg.AddNats(c => c.Url("nats://localhost:4222"));
});
```

> **Note:** Supervisor pattern does **not** apply to gRPC transport. gRPC uses HTTP/2 which has built-in connection recovery managed by ASP.NET Core's Kestrel server.

### IRequestServer Abstraction

A new `IRequestServer` interface has been introduced to standardize transport server implementations, enabling better abstraction and the Supervisor pattern integration.

---

## Breaking Changes

### Response Class Renaming

The following classes have been renamed to simplify the API:

| Old Name | New Name |
|----------|----------|
| `OfXDataResponse` | `DataResponse` |
| `OfXValueResponse` | `ValueResponse` |

**Migration:**
```csharp
// Before (v8.1.x)
OfXDataResponse response = ...;
OfXValueResponse value = ...;

// After (v8.2.0)
DataResponse response = ...;
ValueResponse value = ...;
```

### Removed: OfXConstants

The `OfXConstants` class has been removed. Exception handling is now done through the `Result` pattern and `Fault` class instead of header-based constants.

---

## New Types

### Core Types

| Type | Namespace | Description |
|------|-----------|-------------|
| `Result` | `OfX.Responses` | Functional result type for success/failure handling |
| `Fault` | `OfX.Responses` | Error information container |
| `DataResponse` | `OfX.Responses` | Data response (renamed from OfXDataResponse) |
| `ValueResponse` | `OfX.Responses` | Value response (renamed from OfXValueResponse) |

### Supervision Types

| Type | Namespace | Description |
|------|-----------|-------------|
| `SupervisorOptions` | `OfX.Supervision` | Configuration for supervisor behavior |
| `SupervisionStrategy` | `OfX.Supervision` | Strategy enum: OneForOne, OneForAll, RestForOne |
| `SupervisorDirective` | `OfX.Supervision` | Directive enum: Resume, Restart, Stop, Escalate |
| `ServerHealth` | `OfX.Supervision` | Health states for supervised servers |
| `ServerSupervisor` | `OfX.Supervision` | Base supervisor implementation |
| `IServerSupervisor` | `OfX.Supervision` | Supervisor interface |

### Transport Abstractions

| Type | Namespace | Description |
|------|-----------|-------------|
| `IRequestServer` | `OfX.Abstractions.Transporting` | Common interface for transport servers |

---

## Affected Packages

- **OfX** (core)
- **OfX.Nats**
- **OfX.RabbitMq**
- **OfX.Kafka**
- **OfX.Azure.ServiceBus**
- **OfX.Grpc**
- **OfX.EntityFrameworkCore**
- **OfX.MongoDb**

---

## Upgrade Guide

1. **Update NuGet packages** to v8.2.0
2. **Rename response types:**
   - `OfXDataResponse` -> `DataResponse`
   - `OfXValueResponse` -> `ValueResponse`
3. **Remove references to `OfXConstants`** if any
4. **Optionally configure Supervisor** for message-based transports

---

## Contributors

- quyvu

---

## Links

- [Full Changelog](../changelogs/v8.2.0.md)
- [GitHub Repository](https://github.com/quyvu/OfX)
