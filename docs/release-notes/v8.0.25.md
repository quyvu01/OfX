# Release Notes v8.0.25

## Overview

OfX 8.0.25 introduces **production-grade observability and telemetry** across the entire framework. This release adds comprehensive OpenTelemetry integration, distributed tracing, metrics collection, and diagnostic events to all transport layers and database integrations.

---

## ğŸ‰ What's New

### ğŸ”­ Complete Observability Stack

This release transforms OfX into a fully observable distributed system framework with:

- âœ… **Distributed Tracing** - W3C Trace Context propagation across all transports
- âœ… **Metrics Collection** - OpenTelemetry metrics for all operations
- âœ… **Diagnostic Events** - Structured logging for request lifecycle
- âœ… **Error Tracking** - Comprehensive error categorization and recording

---

## ğŸš€ Key Features

### Distributed Tracing

**All Transport Layers:**

| Transport | Client Tracing | Server Tracing | Trace Propagation | Status |
|-----------|----------------|----------------|-------------------|--------|
| **NATS** | âœ… | âœ… | W3C Headers | âœ… Production Ready |
| **RabbitMQ** | âœ… | âœ… | W3C Headers | âœ… Production Ready |
| **Kafka** | âœ… | âœ… | W3C Headers | âœ… Production Ready |
| **Azure Service Bus** | âœ… | âœ… | ApplicationProperties | âœ… Production Ready |
| **gRPC** | âœ… | âœ… | gRPC Metadata | âœ… Production Ready |

**Database Integrations:**

| Database | Query Tracing | Metrics | Semantic Tags | Status |
|----------|---------------|---------|---------------|--------|
| **Entity Framework Core** | âœ… | âœ… | db.system, db.name, collection | âœ… Production Ready |
| **MongoDB** | âœ… | âœ… | db.system, db.mongodb.collection | âœ… Production Ready |

### Metrics Collection

**Request Metrics:**
```
ofx.request.duration (Histogram)
  Labels: ofx.attribute, ofx.transport, ofx.status

ofx.active_requests (ObservableGauge)
  Real-time concurrent request count

ofx.items.returned (Counter)
  Labels: ofx.attribute, ofx.transport

ofx.errors.count (Counter)
  Labels: ofx.attribute, ofx.transport, ofx.error_type
```

**Database Metrics:**
```
ofx.database.query.duration (Histogram)
  Labels: ofx.attribute, ofx.db_system, ofx.status

ofx.database.errors.count (Counter)
  Labels: ofx.attribute, ofx.db_system, ofx.error_type
```

### Diagnostic Events

**Request Lifecycle:**
- `ofx.request.start` - Request initiated with context
- `ofx.request.stop` - Request completed with metrics
- `ofx.request.error` - Request failed with exception

**Database Lifecycle:**
- `ofx.database.query.start` - Query started
- `ofx.database.query.stop` - Query completed
- `ofx.database.query.error` - Query failed

**Messaging Events:**
- `ofx.message.receive` - Message received from broker
- `ofx.message.send` - Message sent to broker

---

## ğŸ“Š OpenTelemetry Integration

### Semantic Conventions

OfX follows OpenTelemetry semantic conventions for maximum compatibility:

**Messaging Attributes:**
- `messaging.system` - Transport type (nats, rabbitmq, kafka, azureservicebus, grpc)
- `messaging.destination` - Queue/topic/exchange name
- `messaging.message_id` - Message correlation ID
- `messaging.operation` - Operation type (publish, process, receive, call)

**Database Attributes:**
- `db.system` - Database type (efcore, mongodb)
- `db.name` - Database/provider name
- `db.operation` - Query operation (query, find)
- `db.mongodb.collection` - MongoDB collection name (MongoDB only)

**OfX-Specific Attributes:**
- `ofx.attribute` - OfX attribute type name
- `ofx.transport` - Transport layer identifier
- `ofx.expression` - Query expression string
- `ofx.selector_ids` - Selector identifiers array
- `ofx.item_count` - Number of items returned
- `ofx.version` - OfX framework version

---

## ğŸ› ï¸ Configuration

### Quick Start

Add OpenTelemetry packages:

```bash
dotnet add package OpenTelemetry.Exporter.Jaeger
dotnet add package OpenTelemetry.Exporter.Prometheus.AspNetCore
```

Configure in your `Program.cs`:

```csharp
using OpenTelemetry.Trace;
using OpenTelemetry.Metrics;

builder.Services.AddOpenTelemetry()
    .WithTracing(tracing => tracing
        .AddSource("OfX")  // OfX telemetry
        .AddAspNetCoreInstrumentation()
        .AddHttpClientInstrumentation()
        .AddJaegerExporter(options =>
        {
            options.AgentHost = "localhost";
            options.AgentPort = 6831;
        }))
    .WithMetrics(metrics => metrics
        .AddMeter("OfX")  // OfX metrics
        .AddAspNetCoreInstrumentation()
        .AddHttpClientInstrumentation()
        .AddPrometheusExporter());

// Expose Prometheus metrics endpoint
app.MapPrometheusScrapingEndpoint();
```

### Infrastructure Setup

**Using Docker Compose:**

```yaml
version: '3.8'
services:
  jaeger:
    image: jaegertracing/all-in-one:latest
    ports:
      - "6831:6831/udp"
      - "16686:16686"

  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
```

---

## ğŸ“ˆ Use Cases

### Production Monitoring

- Track request latency across distributed services
- Monitor error rates by transport and attribute type
- Alert on slow database queries
- Visualize request flow through service mesh
- Analyze throughput and concurrent load

### Performance Optimization

- Identify bottlenecks in request processing
- Analyze database query performance patterns
- Track item count trends and data volume
- Monitor message broker throughput
- Optimize based on real production metrics

### Debugging & Troubleshooting

- Trace requests across service boundaries
- Correlate errors with specific operations and contexts
- Analyze failed requests with full diagnostic context
- Debug distributed transaction issues
- Root cause analysis with complete trace data

---

## ğŸ”„ Migration Guide

### From v8.2.4 to v8.0.25

**No Breaking Changes!**

This is a **fully backward compatible** release:

- âœ… Zero API changes
- âœ… All existing code continues to work
- âœ… Telemetry is **opt-in** via OpenTelemetry configuration
- âœ… Zero performance impact when telemetry is not configured

**Upgrade Steps:**

1. Update the package:
   ```bash
   dotnet add package OfX --version 8.0.25
   ```

2. (Optional) Add OpenTelemetry configuration to enable telemetry:
   ```csharp
   builder.Services.AddOpenTelemetry()
       .WithTracing(t => t.AddSource("OfX"))
       .WithMetrics(m => m.AddMeter("OfX"));
   ```

3. (Optional) Set up observability backend (Jaeger, Prometheus, etc.)

That's it! Your application continues working exactly as before, with optional telemetry capabilities.

---

## ğŸ¯ Benefits

### For Development

- **Faster debugging** with distributed traces
- **Better understanding** of system behavior
- **Data-driven optimization** based on real metrics
- **Proactive issue detection** before users report problems

### For Operations

- **Production visibility** into distributed systems
- **SLA monitoring** with request duration metrics
- **Error tracking** and alerting
- **Capacity planning** with throughput metrics

### For Business

- **Improved reliability** through better observability
- **Faster incident resolution** with distributed tracing
- **Cost optimization** by identifying inefficiencies
- **Better user experience** through performance insights

---

## ğŸ“š Documentation

For more information:

- [OfX Documentation](https://ofx.quyvu.dev)
- [OpenTelemetry Documentation](https://opentelemetry.io/docs/)
- [Semantic Conventions](https://opentelemetry.io/docs/specs/semconv/)
- [Telemetry Guide](../telemetry.md)

---

## ğŸ” Example: Viewing Traces

**Jaeger UI (http://localhost:16686):**

1. Select "OfX" service
2. Find your operation (e.g., "ofx.request")
3. View complete trace with all spans:
   - Client request span (RabbitMQ publish)
   - Server processing span (RabbitMQ consume)
   - Database query span (EF Core query)
   - Response path spans

Each span includes:
- Duration and timing
- Tags (attribute, transport, expression)
- Logs and events
- Parent-child relationships

**Prometheus Metrics (http://localhost:9090):**

Query examples:
```promql
# Average request duration by attribute
rate(ofx_request_duration_sum[5m]) / rate(ofx_request_duration_count[5m])

# Error rate
rate(ofx_errors_count[5m])

# Active requests
ofx_active_requests

# Database query duration p95
histogram_quantile(0.95, rate(ofx_database_query_duration_bucket[5m]))
```

---

## ğŸ™ Acknowledgments

This release represents a major enhancement to OfX's production readiness and enterprise capabilities. The comprehensive telemetry implementation enables teams to build, monitor, and maintain distributed systems with confidence.

---

## ğŸ“ Next Steps

After upgrading to v8.0.25:

1. âœ… Update your OfX packages
2. âœ… Configure OpenTelemetry (optional)
3. âœ… Set up observability infrastructure (optional)
4. âœ… Create Grafana dashboards for your metrics
5. âœ… Set up alerts based on SLOs
6. âœ… Train your team on using Jaeger for debugging

---

**OfX 8.0.25** - Production-Ready Distributed Observability

Released: January 24, 2025
